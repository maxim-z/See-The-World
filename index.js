var z=Object.defineProperty;var L=(l,e,t)=>e in l?z(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>(L(l,typeof e!="symbol"?e+"":e,t),t);import{W as T,S as D,P as C,C as E,V as I,M as b,a as N,b as x,c as R,d as S,G as U,e as V,T as P,L as F,F as v,f as d,g as B,h as A,i as G,j as W,D as H}from"./vendor.js";const Y=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}};Y();class X{constructor(e=60,t=1.333,i=1,a=1e3){s(this,"aspectRatio");s(this,"fov");s(this,"znear");s(this,"zfar");s(this,"renderer");s(this,"scene");s(this,"camera");s(this,"clock");this.fov=e,this.aspectRatio=t,this.znear=i,this.zfar=a,this.renderer=new T,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",r=>{this.onMouseDown(r)}),window.addEventListener("mouseup",r=>{this.onMouseUp(r)}),window.addEventListener("mousemove",r=>{this.onMouseMove(r)}),window.addEventListener("keydown",r=>{this.onKeyDown(r)}),window.addEventListener("keyup",r=>{this.onKeyUp(r)}),this.scene=new D,this.camera=new C(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new E}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new I;this.renderer.getViewport(e);var t=window.innerWidth/window.innerHeight;this.aspectRatio>t?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onKeyDown(e){}onKeyUp(e){}}class y extends b{constructor(e,t,i){super();s(this,"startTime");s(this,"duration");s(this,"magnitude");s(this,"materialC");s(this,"flatPosition");s(this,"globePosition");this.startTime=t.date.getTime(),this.magnitude=t.normalizedMagnitude,this.duration=i,this.position.copy(e),this.flatPosition=e,this.globePosition=e,this.geometry=new N(this.magnitude/10);var a=new x;a.color=new R(1,(10-this.magnitude)/3.9%1,0),this.material=a,this.materialC=a}getPlaybackLife(e){var t=S.clamp(Math.abs(e/1e3-this.startTime/1e3)/this.duration,0,1);return t}}class Z extends U{constructor(){super();s(this,"earthMesh");s(this,"earthMaterial");s(this,"debugMaterial");s(this,"N");s(this,"M");s(this,"mapMode");s(this,"initialMapPosition");s(this,"globeMapPosition");s(this,"globeNormals");s(this,"morphing");s(this,"morphTime");s(this,"alpha");s(this,"xEarthRotation");s(this,"yConstantEarthRotation");this.earthMesh=new b,this.earthMaterial=new x,this.debugMaterial=new V,this.N=80,this.M=80,this.mapMode=!0,this.initialMapPosition=[],this.globeMapPosition=[],this.globeNormals=[],this.morphing=!1,this.morphTime=500,this.alpha=0,this.xEarthRotation=.13,this.yConstantEarthRotation=.004}initialize(){this.earthMaterial.map=new P().load("./data/earth-1k.png"),this.earthMaterial.map.minFilter=F,this.earthMesh.material=this.earthMaterial,this.debugMaterial.wireframe=!0;for(var e=[],t=-this.N/2;t<this.N/2;t++)for(var i=-this.M/2;i<this.M/2;i++){var a=Math.PI*2/this.N*t,r=Math.PI/this.M*i;e.push(a,r,0);var o=Math.PI*2/this.N*(t+1),h=Math.PI/this.M*i;e.push(o,h,0);var n=Math.PI*2/this.N*t,g=Math.PI/this.M*(i+1);e.push(n,g,0);var m=Math.PI*2/this.N*(t+1),M=Math.PI/this.M*(i+1);e.push(m,M,0)}for(var w=[],t=0;t<4*this.N*this.M;t++)w.push(0,0,1);for(var c=[],t=0;t<4*this.M*this.N;t+=4)c.push(t,t+1,t+2),c.push(t+2,t+1,t+3);for(var u=[],t=0;t<this.N;t++)for(var i=0;i<this.M;i++){var a=t/this.N,r=i/this.M;u.push(a,r);var o=(t+1)/this.N,h=i/this.M;u.push(o,h);var n=t/this.N,g=(i+1)/this.M;u.push(n,g);var m=(t+1)/this.N,M=(i+1)/this.M;u.push(m,M)}this.earthMesh.geometry.setAttribute("position",new v(e,3)),this.earthMesh.geometry.setAttribute("normal",new v(w,3)),this.earthMesh.geometry.setAttribute("uv",new v(u,2));for(var t=0;t<64;t++);this.earthMesh.geometry.setIndex(c),this.add(this.earthMesh);for(var t=0;t<=e.length-3;t+=3)this.initialMapPosition.push(new d(e[t],e[t+1],e[t+2]));for(var t=0;t<=e.length-3;t+=3){var f=this.convertLatLongToSphere(e[t],e[t+1]),p=new d(0,0,0);p=p.subVectors(f,p),this.globeMapPosition.push(f),this.globeNormals.push(p)}}updatePositionOfVertex(e,t,i){var a=this.earthMesh.geometry.attributes.position.getX(e),r=this.earthMesh.geometry.attributes.position.getY(e),o=this.earthMesh.geometry.attributes.position.getZ(e),h=new d(a,r,o),n=h.lerp(t,i);this.earthMesh.geometry.attributes.position.setX(e,n.x),this.earthMesh.geometry.attributes.position.setY(e,n.y),this.earthMesh.geometry.attributes.position.setZ(e,n.z)}update(e){if(this.morphing){this.alpha+=.1*e;var t=!1;if(this.alpha>=.1&&(this.alpha=1,t=!0),this.mapMode){for(var i=0;i<this.earthMesh.geometry.attributes.position.count;i++)this.updatePositionOfVertex(i,this.initialMapPosition[i],this.alpha);for(var i=0;i<this.earthMesh.geometry.attributes.normal.count;i++){var a=this.earthMesh.geometry.attributes.normal.getX(i),r=this.earthMesh.geometry.attributes.normal.getY(i),o=this.earthMesh.geometry.attributes.normal.getZ(i),h=new d(a,r,o).lerp(new d(0,0,1),this.alpha);this.earthMesh.geometry.attributes.normal.setXYZ(i,h.x,h.y,h.z)}var n=new d(this.earthMesh.rotation.x,this.earthMesh.rotation.y,0);n=n.lerp(new d(0,0,0),this.alpha),this.earthMesh.rotation.x=n.x,this.earthMesh.rotation.y=n.y}else{for(var i=0;i<this.earthMesh.geometry.attributes.position.count;i++)this.updatePositionOfVertex(i,this.globeMapPosition[i],this.alpha);for(var i=0;i<this.earthMesh.geometry.attributes.normal.count;i++){var a=this.earthMesh.geometry.attributes.normal.getX(i),r=this.earthMesh.geometry.attributes.normal.getY(i),o=this.earthMesh.geometry.attributes.normal.getZ(i),h=new d(a,r,o).lerp(this.globeNormals[i],this.alpha);this.earthMesh.geometry.attributes.normal.setXYZ(i,h.x,h.y,h.z)}var n=new d(this.earthMesh.rotation.x,0,0);n=n.lerp(new d(this.xEarthRotation,0,0),this.alpha),this.earthMesh.rotation.x=n.x}t&&(console.log("finished morphing!"),this.alpha=0,this.morphing=!1),this.earthMesh.geometry.attributes.position.needsUpdate=!0,this.earthMesh.geometry.attributes.normal.needsUpdate=!0}else this.mapMode||(this.earthMesh.rotation.y+=this.yConstantEarthRotation)}animateEarthquakes(e){this.children.forEach(t=>{if(t instanceof y){t.geometry.scale(.999,.999,.999);var i=new d(t.position.x,t.position.y,t.position.z);if(this.morphing){if(this.mapMode)i=i.lerp(t.flatPosition,this.alpha);else{i=i.lerp(t.globePosition,this.alpha),t.position.x=0,t.position.y=0,t.position.z=0;var a=new d(t.rotation.x,0,0).lerp(new d(this.xEarthRotation,0,0),this.alpha);t.rotation.x=a.x,t.position.x+=i.x,t.position.y+=i.y,t.position.z+=i.z}t.position.x=i.x,t.position.y=i.y,t.position.z=i.z}else if(this.mapMode)t.position.x=t.flatPosition.x,t.position.y=t.flatPosition.y,t.position.z=t.flatPosition.z,t.rotation.x=0,t.rotation.y=0;else{t.rotation.x=this.xEarthRotation;var r=new d(t.globePosition.x,t.globePosition.y,t.globePosition.z);t.position.x=0,t.position.y=0,t.position.z=0,t.rotation.y+=this.yConstantEarthRotation;var o=new B;o.extractRotation(t.matrix),r=r.applyMatrix4(o),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z}t.getPlaybackLife(e)==1&&this.remove(t)}})}createEarthquake(e){var i=this.convertLatLongToPlane(e.latitude,e.longitude),a=new y(i,e,29030400);a.globePosition=this.convertLatLongToSphere(e.latitude,e.longitude),this.add(a)}convertLatLongToPlane(e,t){return new d(t*Math.PI/180,e*Math.PI/180,0)}convertLatLongToSphere(e,t){var i=Math.cos(t)*Math.sin(e),a=Math.sin(t),r=Math.cos(t)*Math.cos(e);return new d(i,a,r)}toggleDebugMode(e){e?this.earthMesh.material=this.debugMaterial:this.earthMesh.material=this.earthMaterial}}class k{constructor(e){s(this,"date");s(this,"longitude");s(this,"latitude");s(this,"magnitude");s(this,"normalizedMagnitude");this.date=new Date,this.date.setUTCFullYear(parseInt(e.substring(12,16))),this.date.setUTCMonth(parseInt(e.substring(17,19))),this.date.setUTCDate(parseInt(e.substring(20,22))),this.date.setUTCHours(parseInt(e.substring(24,26))),this.date.setUTCMinutes(parseInt(e.substring(27,29))),this.date.setUTCSeconds(parseFloat(e.substring(30,35))),this.longitude=parseFloat(e.substring(44,52)),this.latitude=parseFloat(e.substring(37,44)),this.magnitude=parseFloat(e.substring(66,70)),this.normalizedMagnitude=this.magnitude}}class K{constructor(e){s(this,"earthquakes");s(this,"loaded");s(this,"maxMagnitude");s(this,"minMagnitude");s(this,"nextIndex");this.earthquakes=[],this.loaded=!1,this.maxMagnitude=0,this.minMagnitude=1/0,this.nextIndex=0;var t=new A;t.load(e,i=>{var a=i.toString().split(`
`);a.forEach(r=>{if(r.length>30){var o=new k(r);this.earthquakes.push(o),o.magnitude>this.maxMagnitude?this.maxMagnitude=o.magnitude:o.magnitude<this.minMagnitude&&(this.minMagnitude=o.magnitude)}}),this.earthquakes.forEach(r=>{r.normalizedMagnitude=(r.magnitude-this.minMagnitude)/(this.maxMagnitude-this.minMagnitude)}),this.loaded=!0})}reset(){this.nextIndex=0}getNextQuake(e){for(var t=e.getTime();this.nextIndex<this.earthquakes.length;)return this.earthquakes[this.nextIndex].date.getTime()<t?(this.nextIndex++,this.earthquakes[this.nextIndex-1]):null;return null}getMaxTime(){return this.earthquakes[this.earthquakes.length-1].date.getTime()}getMinTime(){return this.earthquakes[0].date.getTime()}}class _ extends X{constructor(){super(60,1920/1080,.1,50);s(this,"earth");s(this,"gui");s(this,"earthquakeDB");s(this,"currentTime");s(this,"mouseDrag");s(this,"mouseVector");s(this,"date");s(this,"viewMode");s(this,"playbackSpeed");s(this,"debugMode");this.gui=new G,this.earth=new Z,this.earthquakeDB=new K("./data/earthquakes.txt"),this.currentTime=1/0,this.mouseDrag=!1,this.mouseVector=new W,this.date="",this.viewMode="Map",this.playbackSpeed=.5,this.debugMode=!1}createScene(){this.camera.position.set(0,0,3.25),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);var e=new H("white",1.5);e.position.set(10,10,15),this.scene.add(e),this.scene.background=new P().load("./data/stars.png"),this.earth.initialize(),this.scene.add(this.earth);var t=this.gui.addFolder("Earthquake Controls"),i=t.add(this,"date");i.name("Current Date"),i.listen();var a=t.add(this,"viewMode",{Map:"Map",Globe:"Globe"});a.name("View Mode"),a.onChange(h=>{h=="Map"?(this.earth.mapMode=!0,console.log("morphing to Map mode")):(this.earth.mapMode=!1,console.log("morphing to Globe mode")),this.earth.morphing=!0,this.earth.alpha=0});var r=t.add(this,"playbackSpeed",0,1);r.name("Playback Speed");var o=t.add(this,"debugMode");o.name("Debug Mode"),o.onChange(h=>{this.toggleDebugMode(h)}),this.gui.width=300,t.open()}update(e){if(!this.earthquakeDB.loaded)return;const t=3e10;this.currentTime+=t*this.playbackSpeed*e,this.currentTime>this.earthquakeDB.getMaxTime()&&(this.currentTime=this.earthquakeDB.getMinTime(),this.earthquakeDB.reset());var i=new Date;i.setTime(this.currentTime),this.date=i.getUTCMonth()+"/"+i.getUTCDate()+"/"+i.getUTCFullYear();for(var a=this.earthquakeDB.getNextQuake(i);a;)this.earth.createEarthquake(a),a=this.earthquakeDB.getNextQuake(i);this.earth.update(e),this.earth.animateEarthquakes(this.currentTime)}toggleDebugMode(e){this.earth.toggleDebugMode(e)}onMouseDown(e){this.mouseDrag=!0}onMouseUp(e){this.mouseDrag=!1}onMouseMove(e){this.mouseDrag,this.mouseVector.set(e.x,e.y)}}var O=new _;O.start();
